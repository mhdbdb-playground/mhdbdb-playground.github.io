<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Mhdbdb project</title>
    <link rel="manifest" href="/mhdbdb/static/manifest.json" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="/mhdbdb/static/css/project.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <script type="text/javascript" language="javascript" src=/mhdbdb/static/js/mhdbdb.js></script>
    <script type="text/javascript" language="javascript" src="/mhdbdb/static/js/SaxonJS2.rt.js"></script>
    <script type="text/javascript" language="javascript" src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dexie@3.0.3/dist/dexie.min.js"></script>
    <script src="/mhdbdb/static/js/projectDB.js"></script>
    <script src="/mhdbdb/static/js/mhdbdbBasket.js"></script>

    <script>

      (async () => {
        window.gams.projectDB.initDB(
          // project abbreviation
          "mhdbdb", 
          // expiration of the database: until which date the database is valid
          // (database will be rebuilt if createdAt from db is BEFORE this date)
          new Date(1000)
        );

      })();


      
    </script>
  </head>
  

  
  <script>
    window.GAMS = window.GAMS || {};
    window.GAMS.GAMS_API_ORIGIN = "http://localhost:18085";
    window.GAMS.PROJECT_ABBR = "mhdbdb";
  </script>

  <body>
    <nav class="navbar bd-navbar navbar-expand-lg mb-3 sticky-top bg-white">
  <div class="container">
    <a class="navbar-brand" href="/mhdbdb" style="text-transform:uppercase;">mhdbdb</a>
    <button class="navbar-toggler text-light" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon text-light"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="/mhdbdb/objects">Werke</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="/mhdbdb/lemma-register.html">Lemmaregister</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="/mhdbdb/objects/mhdbdb.lexicon">Lemmata</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="/mhdbdb/objects/mhdbdb.concepts">Begriffssystem (Bedeutungen)</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="/mhdbdb/objects/mhdbdb.names">Namenssystem</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="/mhdbdb/objects/mhdbdb.persons">Personenregister</a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            About
          </a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="/mhdbdb/about.html">About</a></li>
            <li><a class="dropdown-item" href="/mhdbdb/imprint.html">Impressum</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="#">Datenmodell</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>
    <div class="modal modal-xl" tabindex="-1" id="wordBasketModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">MHDBDB Wortkoffer</h2>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <ul id="wordBasketList" class="list-group list-group-flush"></ul>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline-secondary" id="clearWordBasket">Wortkoffer leeren</button>
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Schließen</button>
      </div>
    </div>
  </div>  
</div>
<button style="position: fixed; bottom: 20px; right: 20px; z-index: 1050; border-radius: 50px; box-shadow: 0 4px 20px rgba(0,0,0,0.3); transition: all 0.3s ease; min-width: 120px;" 
        type="button" 
        class="btn btn-dark d-flex align-items-center justify-content-center btn-lg" 
        data-bs-toggle="modal" 
        data-bs-target="#wordBasketModal"
        onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 6px 25px rgba(0,0,0,0.4)'"
        onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 20px rgba(0,0,0,0.3)'">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="me-2">
        <path d="M7 4V2C7 1.45 7.45 1 8 1H16C16.55 1 17 1.45 17 2V4H20C20.55 4 21 4.45 21 5S20.55 6 20 6H19V19C19 20.1 18.1 21 17 21H7C5.9 21 5 20.1 5 19V6H4C3.45 6 3 5.55 3 5S3.45 4 4 4H7ZM9 3V4H15V3H9ZM7 6V19H17V6H7Z"/>
        <path d="M9 8V17H11V8H9ZM13 8V17H15V8H13Z"/>
    </svg>
    Wortkoffer
</button>
<script>

  (() => {
    const wordBasketModal = document.getElementById("wordBasketModal");
    const modalBody = wordBasketModal.querySelector(".modal-body");
    const wordBasketList = modalBody.querySelector("#wordBasketList");

    wordBasketModal.addEventListener("show.bs.modal", (event) => {
      wordBasketList.innerHTML = "";

      // list all items from local storage
      // sort by lemmaRef
      mhdbdbBasket.findAll().sort((a, b) => a.wordLemmaRef.localeCompare(b.wordLemmaRef)).forEach(item => {
        const listItem = document.createElement("li");
        listItem.className = "list-group-item";
        listItem.textContent = item;

        const TEXT_SIGLE = item.wordId.split("_")[0];

        listItem.innerHTML = `
          <p class="mb-0"><button class="btn btn-outline-light text-dark btn-sm float-end ms-2" type="button" data-bs-toggle="collapse" data-bs-target="#collapse_${item.wordId}" aria-expanded="false" aria-controls="collapse_${item.wordId}">...</button><a href="/mhdbdb/objects/mhdbdb.${TEXT_SIGLE}#${item.wordId}" class="float-end">(${TEXT_SIGLE})</a> ${item.wordContext.replace(item.word, '<strong class="bg-warning">$&</strong>')}</p>
        `;


        const collapseDiv = document.createElement("div");


        collapseDiv.className = "collapse bg-light p-2";
        collapseDiv.id = `collapse_${item.wordId}`;
        collapseDiv.innerHTML = `
          <strong>Wort:</strong> ${item.word} <br />
          <strong>Bedeutungs-Id:</strong> ${item.wordMeaningRef} <br />
          <strong>LemmaId:</strong> ${item.wordLemmaRef} <br />
        `;

        let collapseDetails = document.createElement("div");
        collapseDiv.appendChild(collapseDetails);
        listItem.appendChild(collapseDiv);

        collapseDiv.addEventListener('show.bs.collapse', event => {
          collapseDetails.innerHTML = "";

          gams.projectDB.findLemmaById(item.wordLemmaRef, foundLemma => {
            collapseDetails.innerHTML += `
              <strong>Lemma:</strong> ${foundLemma.label_s} <br />
            `;
          });

          gams.projectDB.findConceptLabelBySenseId(item.wordMeaningRef, conceptLabel => {
            collapseDetails.innerHTML += `
              <strong>Bedeutung:</strong> ${conceptLabel} <br />
            `;
          });

        })

        wordBasketList.appendChild(listItem);
      });

    });


    const clearWordBasketButton = wordBasketModal.querySelector("#clearWordBasket");
    clearWordBasketButton.addEventListener("click", () => {
      mhdbdbBasket.deleteAll();
      wordBasketList.innerHTML = "";
      window.location.reload();
    });

  })();
</script>
    <main class="container">
    
    <h1>MHDBDB</h1>
    <h2 class="h3 fw-light">Mittelhochdeutsche Begriffsdatenbank</h2>
    <hr/>
    <p>Die neue MHDBDB befindet sich in der Open Beta-Version und die Funktionalität ist noch stark eingeschränkt. In der Übergangszeit steht weiterhin die alte Plattform in gewohntem Umfang bereit (oben rechts: Alte MHDBDB).</p>

    <form>
    <div class="mb-3">
        <label for="entrySearch" class="form-label">Lemmasuche</label>
        <input disabled oninput="lemmaSearch()" type="text" class="form-control" id="entrySearch" aria-describedby="emailHelp">
        <div id="emailHelp" class="form-text">Teilstring in einem lemma suchen</div>
    </div>
</form>

<div id="spinner" class="spinner-border" role="status">
  <span class="visually-hidden">Loading...</span>
</div>
<div id="search-results"></div>

<script>

    let globalResultObject = null;

    const lemmaSearch = () => {
        console.log("Search triggered");
        if(!globalResultObject) {
            console.error("Result object is not initialized.");
            return;
        }

        // Perform search on the globalResultObject
        let searchTerm = document.getElementById("entrySearch").value;

        if (!searchTerm) {
            console.error("Search term is empty.");
            return;
        }

        console.log(`Searching for term: ${searchTerm}`);

        let resultArray = []
        globalResultObject.result.forEach(lemma => {
            if(lemma.label_s.includes(searchTerm))
                resultArray.push(lemma);
        });


        let searchResultDiv = document.getElementById("search-results");
        searchResultDiv.innerHTML = ""; // Clear previous results
        if (resultArray.length === 0) {
            searchResultDiv.innerHTML = "<p>No results found.</p>";
            return;
        }
        let ul = document.createElement("ul");
        ul.className = "list-group";
        resultArray.slice(0, 50).forEach(lemma => {

            let lemmaLabelHighlighted = lemma.label_s.replace(new RegExp(searchTerm, 'gi'), match => `<span class="bg-warning">${match}</span>`);

            let li = document.createElement("li");
            li.className = "list-group-item mb-2 border";
            li.innerHTML = `<p>
                <a class="h5 text-decoration-none" target="_blank" href="/mhdbdb/objects/mhdbdb.lexicon#${lemma.id}">${lemmaLabelHighlighted}</a>
                <br/>
                <span class="text-muted">Textvorkommen: ${lemma.texts_ss.length}</span>
                <br/>
            </p>`;


            lemma.texts_ss.forEach(text => {
                let textLink = document.createElement("span");
                textLink.textContent = text;
                textLink.className = "text-decoration-none me-2";
                textLink.style.cursor = "pointer";
                textLink.setAttribute("tabindex", "0");
                textLink.setAttribute("data-bs-toggle", "popover");
                textLink.setAttribute("data-bs-title", lemma.label_s + " in " + text);
                textLink.setAttribute("data-bs-placement", "top");
                textLink.setAttribute("data-html", "true");
                textLink.setAttribute("data-bs-content", `
                    <i>Lemmareferenzen</i>
                    <ul class="mb-2">
                        <li><a tabindex="0" target="_blank" href="/mhdbdb/objects/mhdbdb.${text.toLowerCase()}?mode=text_analysis&anyRef=${lemma.id}">Analyseansicht</a></li>
                        <li><a tabindex="0" target="_blank" href="/mhdbdb/objects/mhdbdb.${text.toLowerCase()}#${lemma.id}">Interaktionsansicht</a></li>
                    </ul>
                `);
                li.appendChild(textLink);
                new bootstrap.Popover(textLink, {
                    trigger: 'hover',
                    html: true,
                    // this will ensure that popover is not closed when clicking on the link inside it
                    container: textLink
                });

            });
            ul.appendChild(li);

            
        });

        searchResultDiv.appendChild(ul);
        console.log(`Found ${resultArray.length} results for "${searchTerm}"`);
    }

    document.addEventListener("PROJECTDB_READY", () => {
        console.log("PROJECTDB_READY event received, initializing search...");
        let startTime = performance.now();
        window.gams.projectDB.findAllLemmataAwait(resultObject => {
            globalResultObject = resultObject;
            document.getElementById("spinner").style.display = "none";
            document.getElementById("entrySearch").disabled = false;
        }, 
        "", 
        {offset:0, limit: 1000000000000000}, 
        true);
    });
</script>

    <br/>
    <br/>
    <br/>
    <br/>
    <br/>
    <!-- <h3>Über die MHDBDB</h3>
    <div class="row">
        <div class="col-md-9">
            <p>Die MHDBDB ermöglicht den Zugriff auf die wichtigsten Werke der mittelhochdeutschen Dichtung durch vielseitige Suchfunktionen. Man kann nach Wörtern, Zeichenketten und Begriffen in ausgewählten Werken suchen und linguistische oder semantische Fragestellungen auswerten.</p>
            <a target="_blank" href="http://localhost:18085/api/v1/projects/mhdbdb/objects/mhdbdb.material/datastreams/ULRICH_COVER.jpg/content"><img class="border" src="http://localhost:18085/api/v1/projects/mhdbdb/objects/mhdbdb.material/datastreams/ULRICH_COVER.jpg/content" /></a>
        </div>
        <div class="col">
            <a target="_blank" href="http://localhost:18085/api/v1/projects/mhdbdb/objects/mhdbdb.material/datastreams/LOGO_MAIN01.png/content"><img class="border" src="http://localhost:18085/api/v1/projects/mhdbdb/objects/mhdbdb.material/datastreams/LOGO_MAIN01.png/content" /></a>
            <a target="_blank" href="http://localhost:18085/api/v1/projects/mhdbdb/objects/mhdbdb.material/datastreams/LOGO_IZMF.png/content"><img class="border mt-2" width="300" src="http://localhost:18085/api/v1/projects/mhdbdb/objects/mhdbdb.material/datastreams/LOGO_IZMF.png/content" /></a>
            <a target="_blank" href="http://localhost:18085/api/v1/projects/mhdbdb/objects/mhdbdb.material/datastreams/MHDBDB_FIGURE.gif/content"><img class="border mt-2" width="300" src="http://localhost:18085/api/v1/projects/mhdbdb/objects/mhdbdb.material/datastreams/MHDBDB_FIGURE.gif/content" /></a>
            <a target="_blank" href="http://localhost:18085/api/v1/projects/mhdbdb/objects/mhdbdb.material/datastreams/CLARIAH_LOGO.png/content"><img class="border mt-2" width="300" src="http://localhost:18085/api/v1/projects/mhdbdb/objects/mhdbdb.material/datastreams/CLARIAH_LOGO.png/content" /></a>
            <a target="_blank" href="http://localhost:18085/api/v1/projects/mhdbdb/objects/mhdbdb.material/datastreams/CLARIAH_LOGO.png/content"><img class="border mt-2" width="300" src="http://localhost:18085/api/v1/projects/mhdbdb/objects/mhdbdb.material/datastreams/FBGERMANISTIK_LOGO1.jpg/content" /></a>
        </div>
    </div> -->

    


    </main>
    <footer class="mt-md-5 pb-md-5 pt-md-5 bg-light">
    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <ul class="list-unstyled">
                    <li><a href="/mhdbdb/imprint.html">Impressum</a></li>
                    <li><a target="_blank" href="https://gams.uni-graz.at/archive/objects/context:gams/methods/sdef:Context/get?mode=dataprotection&locale=de">Datenschutz</a></li>
                </ul>
                <h3 class="h5">Kontakt</h3>
                <ul class="list-unstyled">
                    <li>Sebastian David Schiller-Stoff</li>
                    <li>DDH | Institut für Digitale Geisteswissenschaften</li>
                    <li>Universität Graz</li>
                    <li><a target="_blank" href="https://gams.uni-graz.at/archive/objects/context:gams/methods/sdef:Context/get?mode=dataprotection&locale=de"><img width="200" src="https://gams.uni-graz.at/templates/img/by-nc.png"/></a></li>
                </ul>
            </div>
            <!-- <div class="col-md-6">
                <a target="_blank" href="http://localhost:18085/api/v1/projects/mhdbdb/objects/mhdbdb.material/datastreams/LOGO_MAIN01.png/content"><img src="http://localhost:18085/api/v1/projects/mhdbdb/objects/mhdbdb.material/datastreams/LOGO_MAIN01.png/content" /></a>
                <a target="_blank" href="http://localhost:18085/api/v1/projects/mhdbdb/objects/mhdbdb.material/datastreams/LOGO_IZMF.png/content"><img width="300" src="http://localhost:18085/api/v1/projects/mhdbdb/objects/mhdbdb.material/datastreams/LOGO_IZMF.png/content" /></a>
                <a target="_blank" href="http://localhost:18085/api/v1/projects/mhdbdb/objects/mhdbdb.material/datastreams/CLARIAH_LOGO.png/content"><img width="300" src="http://localhost:18085/api/v1/projects/mhdbdb/objects/mhdbdb.material/datastreams/CLARIAH_LOGO.png/content" /></a>
                <a target="_blank" href="http://localhost:18085/api/v1/projects/mhdbdb/objects/mhdbdb.material/datastreams/CLARIAH_LOGO.png/content"><img width="300" src="http://localhost:18085/api/v1/projects/mhdbdb/objects/mhdbdb.material/datastreams/FBGERMANISTIK_LOGO1.jpg/content" /></a>
            </div> -->
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    
  </body>
</html>