<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Mhdbdb project</title>
    <link rel="manifest" href="/mhdbdb/static/manifest.json" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="/mhdbdb/static/css/project.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <script type="text/javascript" language="javascript" src=/mhdbdb/static/js/mhdbdb.js></script>
    <script type="text/javascript" language="javascript" src="/mhdbdb/static/js/SaxonJS2.rt.js"></script>
    <script type="text/javascript" language="javascript" src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dexie@3.0.3/dist/dexie.min.js"></script>
    <script src="/mhdbdb/static/js/projectDB.js"></script>
    <script src="/mhdbdb/static/js/mhdbdbBasket.js"></script>

    <script>

      (async () => {

        window.gams.projectDB.initDB(
          // project abbreviation
          "mhdbdb", 
          // expiration of the database: until which date the database is valid
          // (database will be rebuilt if createdAt from db is BEFORE this date)
          new Date(1000)
        );

      })();


      
    </script>
  </head>
  

  
  <script>
    window.GAMS = window.GAMS || {};
    window.GAMS.GAMS_API_ORIGIN = "http://localhost:18085";
    window.GAMS.PROJECT_ABBR = "mhdbdb";
  </script>

  <body>
    <nav class="navbar bd-navbar navbar-expand-lg mb-3 sticky-top bg-white">
  <div class="container">
    <a class="navbar-brand" href="/mhdbdb" style="text-transform:uppercase;">mhdbdb</a>
    <button class="navbar-toggler text-light" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon text-light"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="/mhdbdb/objects">Werke</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="/mhdbdb/lemma-register.html">Lemmaregister</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="/mhdbdb/objects/mhdbdb.lexicon">Lemmata</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="/mhdbdb/objects/mhdbdb.concepts">Begriffssystem (Bedeutungen)</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="/mhdbdb/objects/mhdbdb.names">Namenssystem</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="/mhdbdb/objects/mhdbdb.persons">Personenregister</a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            About
          </a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="/mhdbdb/about.html">About</a></li>
            <li><a class="dropdown-item" href="/mhdbdb/imprint.html">Impressum</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="#">Datenmodell</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>
    <div class="modal modal-xl" tabindex="-1" id="wordBasketModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">MHDBDB Wortkoffer</h2>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <ul id="wordBasketList" class="list-group list-group-flush"></ul>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline-secondary" id="clearWordBasket">Wortkoffer leeren</button>
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Schließen</button>
      </div>
    </div>
  </div>  
</div>
<button style="position: fixed; bottom: 20px; right: 20px; z-index: 1050; border-radius: 50px; box-shadow: 0 4px 20px rgba(0,0,0,0.3); transition: all 0.3s ease; min-width: 120px;" 
        type="button" 
        class="btn btn-dark d-flex align-items-center justify-content-center btn-lg" 
        data-bs-toggle="modal" 
        data-bs-target="#wordBasketModal"
        onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 6px 25px rgba(0,0,0,0.4)'"
        onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 20px rgba(0,0,0,0.3)'">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="me-2">
        <path d="M7 4V2C7 1.45 7.45 1 8 1H16C16.55 1 17 1.45 17 2V4H20C20.55 4 21 4.45 21 5S20.55 6 20 6H19V19C19 20.1 18.1 21 17 21H7C5.9 21 5 20.1 5 19V6H4C3.45 6 3 5.55 3 5S3.45 4 4 4H7ZM9 3V4H15V3H9ZM7 6V19H17V6H7Z"/>
        <path d="M9 8V17H11V8H9ZM13 8V17H15V8H13Z"/>
    </svg>
    Wortkoffer
</button>
<script>

  (() => {
    const wordBasketModal = document.getElementById("wordBasketModal");
    const modalBody = wordBasketModal.querySelector(".modal-body");
    const wordBasketList = modalBody.querySelector("#wordBasketList");

    wordBasketModal.addEventListener("show.bs.modal", (event) => {
      wordBasketList.innerHTML = "";

      // list all items from local storage
      // sort by lemmaRef
      mhdbdbBasket.findAll().sort((a, b) => a.wordLemmaRef.localeCompare(b.wordLemmaRef)).forEach(item => {
        const listItem = document.createElement("li");
        listItem.className = "list-group-item";
        listItem.textContent = item;

        const TEXT_SIGLE = item.wordId.split("_")[0];

        listItem.innerHTML = `
          <p class="mb-0"><button class="btn btn-outline-light text-dark btn-sm float-end ms-2" type="button" data-bs-toggle="collapse" data-bs-target="#collapse_${item.wordId}" aria-expanded="false" aria-controls="collapse_${item.wordId}">...</button><a href="/mhdbdb/objects/mhdbdb.${TEXT_SIGLE}#${item.wordId}" class="float-end">(${TEXT_SIGLE})</a> ${item.wordContext.replace(item.word, '<strong class="bg-warning">$&</strong>')}</p>
        `;


        const collapseDiv = document.createElement("div");


        collapseDiv.className = "collapse bg-light p-2";
        collapseDiv.id = `collapse_${item.wordId}`;
        collapseDiv.innerHTML = `
          <strong>Wort:</strong> ${item.word} <br />
          <strong>Bedeutungs-Id:</strong> ${item.wordMeaningRef} <br />
          <strong>LemmaId:</strong> ${item.wordLemmaRef} <br />
        `;

        let collapseDetails = document.createElement("div");
        collapseDiv.appendChild(collapseDetails);
        listItem.appendChild(collapseDiv);

        collapseDiv.addEventListener('show.bs.collapse', event => {
          collapseDetails.innerHTML = "";

          gams.projectDB.findLemmaById(item.wordLemmaRef, foundLemma => {
            collapseDetails.innerHTML += `
              <strong>Lemma:</strong> ${foundLemma.label_s} <br />
            `;
          });

          gams.projectDB.findConceptLabelBySenseId(item.wordMeaningRef, conceptLabel => {
            collapseDetails.innerHTML += `
              <strong>Bedeutung:</strong> ${conceptLabel} <br />
            `;
          });

        })

        wordBasketList.appendChild(listItem);
      });

    });


    const clearWordBasketButton = wordBasketModal.querySelector("#clearWordBasket");
    clearWordBasketButton.addEventListener("click", () => {
      mhdbdbBasket.deleteAll();
      wordBasketList.innerHTML = "";
      window.location.reload();
    });

  })();
</script>
    <main class="container">
    
    <h1>MHDBDB Semantic Concepts Taxonomy</h1>
    <h2 class="h3 fw-light">Mittelhochdeutsche Begriffsdatenbank</h2>
    <hr/>
    <p class="manuscript-citation text-muted"><b>Beschreibung: </b>'Concepts' taxonomy developed and used in the MHDBDB project.
        The concepts are used to classify and describe the objects in the
        MHDBDB database, providing a structured way to understand and
        navigate the data.
    </p>
    <div class="row mb-3">
      <div class="col-md-6">
        <div>
          <a class="btn btn-outline-secondary" target="_blank" href="http://localhost:18085/api/v1/projects/mhdbdb/objects/mhdbdb.concepts">Metadatenansicht</a>
          <a class="btn btn-outline-secondary" target="_blank" href="http://localhost:18085/api/v1/projects/mhdbdb/objects/mhdbdb.concepts/datastreams/TEI.xml/content">TEI Dokument</a>
          <a class="btn btn-outline-secondary" target="_blank" href="http://localhost:18085/api/v1/projects/mhdbdb/objects/mhdbdb.concepts/datastreams/DC.xml/content">Dublin Core</a>
        </div>
      </div>
      <div class="col">
        
        
      </div>
    </div>

    
            
              


    
<p>Design / Architektur</p>
<ol>
    <li>Fetch / parse Konzeptliste direkt vom TEI und Aufbau einer js Datenstruktur (ViewModel pattern)</li>
    <li>Ableitung einer Liste auf Basis dieses ViewModels</li>
    <li>Ermöglichen des Ladens / Anzeigens zusätzlicher Daten aus dem indexedDB-Workflow über onclick (verbundene Bedeutungen und Lemmata)</li>
</ol>
<hr/>
<h3 class="h4">Konzepte</h3>

<ul id="concept-list" class="list-group"></ul>


<script>
    document.addEventListener("PROJECTDB_READY", (event) => {
        fetch(`/mhdbdb/data/authority/mhdbdb.concepts/TEI.xml`)
            .then(response => {
                // parse xml
                return response.text();
            })
            .then(xmlString => {
                console.log("Fetched concept data:", xmlString);
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlString, "application/xml");
                const concepts = [];

                xmlDoc.querySelectorAll("category").forEach(category => {
                    let conceptId = category.getAttribute("xml:id");
                    let conceptTerms = [];
                    category.querySelectorAll("term").forEach(term => {
                        let curTermText = term.textContent.trim().normalize();
                        curTermText = curTermText.replace(/\s+/g, " "); // normalize whitespace
                        let curTerm = { 
                            type: term.getAttribute("type"), 
                            value: curTermText,
                            lang: term.getAttribute("xml:lang")
                        };
                        conceptTerms.push(curTerm);
                    });

                    let conceptPtr = [];
                    category.querySelectorAll("ptr").forEach(pointer => {
                        let curPointer = {
                            type: pointer.getAttribute("type"),
                            target: pointer.getAttribute("target")
                        };
                        conceptPtr.push(curPointer);
                    });
                    let concept = {
                        id: conceptId,
                        terms: conceptTerms,
                        pointers: conceptPtr
                    };

                    concepts.push(concept);
                });


                // emit an event
                const event = new CustomEvent("CONCEPTS_LOADED", { detail: concepts });
                document.dispatchEvent(event);

            })
            .catch(error => {
                console.error("Error fetching concept data:", error);
            });


        document.addEventListener("CONCEPTS_LOADED", (event) => {
            console.log("Got concepts from TEI:", event.detail);
            // Populate the concept list
            const conceptList = document.getElementById("concept-list");
            conceptList.innerHTML = ""; // Clear existing list

            // sort according to first term (=ger term)
            event.detail.sort((a, b) => a.terms[0].value.localeCompare(b.terms[0].value)).forEach(concept => {
                const listItem = document.createElement("li");
                listItem.className = "list-group-item accordion mb-2 p-0";

                let accordionItem = document.createElement("div");
                accordionItem.className = "accordion-item";

                let accordionHeader = document.createElement("div");
                accordionHeader.className = "accordion-header";
                accordionItem.appendChild(accordionHeader);
                accordionHeader.innerHTML = `
                    <button id="${concept.id}" class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#accordionItemBody_${concept.id}" aria-expanded="true" aria-controls="${concept.id}">${concept.terms[0].value} <small class="muted">(${concept.terms.length})</small></button>
                `;
                let accordionItemCollaps = document.createElement("div");
                accordionItemCollaps.className = "accordion-collapse collapse";
                accordionItemCollaps.id = `accordionItemBody_${concept.id}`;

                let accordionItemBody = document.createElement("div");
                accordionItemBody.className = "accordion-body";

                accordionItemBody.innerHTML = `
                    <p><strong>Concept ID:</strong> ${concept.id}</p>
                    <p><strong>Terms:</strong></p>
                    <ul>
                        ${concept.terms.map(term => `<li>${term.value} (${term.lang})</li>`).join("")}
                    </ul>
                    <br/>
                    <p><strong>Pointers:</strong></p>
                    <ul>
                        ${concept.pointers.map(ptr => `<li>${ptr.type}: ${ptr.target}</li>`).join("")}
                    </ul>
                    <div id="lemmata_${concept.id}"></div>
                    <br/>
                `;

                accordionItemCollaps.appendChild(accordionItemBody);
                accordionItem.appendChild(accordionItemCollaps);
                listItem.appendChild(accordionItem);
                conceptList.appendChild(listItem);

                let loadLemmataButton = document.createElement("button");
                loadLemmataButton.className = "btn btn-outline-secondary";
                loadLemmataButton.id = `load-lemmata-${concept.id}`;
                loadLemmataButton.innerText = "Lemmata anzeigen";
                accordionItemBody.appendChild(loadLemmataButton);

                loadLemmataButton.addEventListener("click", () => {
                    window.gams.projectDB.findConceptById(concept.id, resultObject => {
                        console.log("Received result object:", resultObject);
                        let lemmataDiv = document.getElementById(`lemmata_${concept.id}`);
                        lemmataDiv.innerHTML = `
                            <br/>
                        <p><strong>Lemmata</strong> (${resultObject.lemmata.length})</p>
                        <ul>
                            ${resultObject.lemmata.sort(
                                (a, b) => a.label_s.localeCompare(b.label_s)
                            ).map(lemma => `<li><a target="_blank" href="/mhdbdb/objects/mhdbdb.lexicon#${lemma.id}">${lemma.label_s} (${lemma.id})</a></li>`).join("")}
                        </ul>
                        `;
                    });
                });
            });

            // read out hash value
            const hashValue = window.location.hash;

            // Check if the hash value corresponds to a concept ID
            if (hashValue) {
                // scroll to element with ID
                const conceptId = hashValue.replace("#", "");
                const conceptElement = document.getElementById(conceptId);
                conceptElement.classList.remove("collapsed");

                let curAccordionCollapse = document.getElementById(`accordionItemBody_${conceptId}`);
                curAccordionCollapse.classList.add("show");

                if (conceptElement) {
                    conceptElement.scrollIntoView({ behavior: "smooth" });
                }
            }
        });
    });

</script>

            
    



    </main>
    <footer class="mt-md-5 pb-md-5 pt-md-5 bg-light">
    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <ul class="list-unstyled">
                    <li><a href="/mhdbdb/imprint.html">Impressum</a></li>
                    <li><a target="_blank" href="https://gams.uni-graz.at/archive/objects/context:gams/methods/sdef:Context/get?mode=dataprotection&locale=de">Datenschutz</a></li>
                </ul>
                <h3 class="h5">Kontakt</h3>
                <ul class="list-unstyled">
                    <li>Sebastian David Schiller-Stoff</li>
                    <li>DDH | Institut für Digitale Geisteswissenschaften</li>
                    <li>Universität Graz</li>
                    <li><a target="_blank" href="https://gams.uni-graz.at/archive/objects/context:gams/methods/sdef:Context/get?mode=dataprotection&locale=de"><img width="200" src="https://gams.uni-graz.at/templates/img/by-nc.png"/></a></li>
                </ul>
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    
  </body>
</html>