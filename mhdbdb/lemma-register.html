<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Mhdbdb project</title>
    <link rel="manifest" href="/mhdbdb/static/manifest.json" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="/mhdbdb/static/css/project.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <script type="text/javascript" language="javascript" src=/mhdbdb/static/js/mhdbdb.js></script>
    <script type="text/javascript" language="javascript" src="/mhdbdb/static/js/SaxonJS2.rt.js"></script>
    <script type="text/javascript" language="javascript" src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dexie@3.0.3/dist/dexie.min.js"></script>
    <script src="/mhdbdb/static/js/projectDB.js"></script>
    <script src="/mhdbdb/static/js/mhdbdbBasket.js"></script>

    <script>

      (async () => {
        window.gams.projectDB.initDB(
          // project abbreviation
          "mhdbdb", 
          // expiration of the database: until which date the database is valid
          // (database will be rebuilt if createdAt from db is BEFORE this date)
          new Date(1000)
        );

      })();


      
    </script>
  </head>
  

  
  <script>
    window.GAMS = window.GAMS || {};
    window.GAMS.GAMS_API_ORIGIN = "http://localhost:18085";
    window.GAMS.PROJECT_ABBR = "mhdbdb";
  </script>

  <body>
    <nav class="navbar bd-navbar navbar-expand-lg mb-3 sticky-top bg-white">
  <div class="container">
    <a class="navbar-brand" href="/mhdbdb" style="text-transform:uppercase;">mhdbdb</a>
    <button class="navbar-toggler text-light" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon text-light"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="/mhdbdb/objects">Werke</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="/mhdbdb/lemma-register.html">Lemmaregister</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="/mhdbdb/objects/mhdbdb.lexicon">Lemmata</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="/mhdbdb/objects/mhdbdb.concepts">Begriffssystem (Bedeutungen)</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="/mhdbdb/objects/mhdbdb.names">Namenssystem</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="/mhdbdb/objects/mhdbdb.persons">Personenregister</a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            About
          </a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="/mhdbdb/about.html">About</a></li>
            <li><a class="dropdown-item" href="/mhdbdb/imprint.html">Impressum</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="#">Datenmodell</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>
    <div class="modal modal-xl" tabindex="-1" id="wordBasketModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">MHDBDB Wortkoffer</h2>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <ul id="wordBasketList" class="list-group list-group-flush"></ul>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline-secondary" id="clearWordBasket">Wortkoffer leeren</button>
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Schließen</button>
      </div>
    </div>
  </div>  
</div>
<button style="position: fixed; bottom: 20px; right: 20px; z-index: 1050; border-radius: 50px; box-shadow: 0 4px 20px rgba(0,0,0,0.3); transition: all 0.3s ease; min-width: 120px;" 
        type="button" 
        class="btn btn-dark d-flex align-items-center justify-content-center btn-lg" 
        data-bs-toggle="modal" 
        data-bs-target="#wordBasketModal"
        onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 6px 25px rgba(0,0,0,0.4)'"
        onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 20px rgba(0,0,0,0.3)'">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="me-2">
        <path d="M7 4V2C7 1.45 7.45 1 8 1H16C16.55 1 17 1.45 17 2V4H20C20.55 4 21 4.45 21 5S20.55 6 20 6H19V19C19 20.1 18.1 21 17 21H7C5.9 21 5 20.1 5 19V6H4C3.45 6 3 5.55 3 5S3.45 4 4 4H7ZM9 3V4H15V3H9ZM7 6V19H17V6H7Z"/>
        <path d="M9 8V17H11V8H9ZM13 8V17H15V8H13Z"/>
    </svg>
    Wortkoffer
</button>
<script>

  (() => {
    const wordBasketModal = document.getElementById("wordBasketModal");
    const modalBody = wordBasketModal.querySelector(".modal-body");
    const wordBasketList = modalBody.querySelector("#wordBasketList");

    wordBasketModal.addEventListener("show.bs.modal", (event) => {
      wordBasketList.innerHTML = "";

      // list all items from local storage
      // sort by lemmaRef
      mhdbdbBasket.findAll().sort((a, b) => a.wordLemmaRef.localeCompare(b.wordLemmaRef)).forEach(item => {
        const listItem = document.createElement("li");
        listItem.className = "list-group-item";
        listItem.textContent = item;

        const TEXT_SIGLE = item.wordId.split("_")[0];

        listItem.innerHTML = `
          <p class="mb-0"><button class="btn btn-outline-light text-dark btn-sm float-end ms-2" type="button" data-bs-toggle="collapse" data-bs-target="#collapse_${item.wordId}" aria-expanded="false" aria-controls="collapse_${item.wordId}">...</button><a href="/mhdbdb/objects/mhdbdb.${TEXT_SIGLE}#${item.wordId}" class="float-end">(${TEXT_SIGLE})</a> ${item.wordContext.replace(item.word, '<strong class="bg-warning">$&</strong>')}</p>
        `;


        const collapseDiv = document.createElement("div");


        collapseDiv.className = "collapse bg-light p-2";
        collapseDiv.id = `collapse_${item.wordId}`;
        collapseDiv.innerHTML = `
          <strong>Wort:</strong> ${item.word} <br />
          <strong>Bedeutungs-Id:</strong> ${item.wordMeaningRef} <br />
          <strong>LemmaId:</strong> ${item.wordLemmaRef} <br />
        `;

        let collapseDetails = document.createElement("div");
        collapseDiv.appendChild(collapseDetails);
        listItem.appendChild(collapseDiv);

        collapseDiv.addEventListener('show.bs.collapse', event => {
          collapseDetails.innerHTML = "";

          gams.projectDB.findLemmaById(item.wordLemmaRef, foundLemma => {
            collapseDetails.innerHTML += `
              <strong>Lemma:</strong> ${foundLemma.label_s} <br />
            `;
          });

          gams.projectDB.findConceptLabelBySenseId(item.wordMeaningRef, conceptLabel => {
            collapseDetails.innerHTML += `
              <strong>Bedeutung:</strong> ${conceptLabel} <br />
            `;
          });

        })

        wordBasketList.appendChild(listItem);
      });

    });


    const clearWordBasketButton = wordBasketModal.querySelector("#clearWordBasket");
    clearWordBasketButton.addEventListener("click", () => {
      mhdbdbBasket.deleteAll();
      wordBasketList.innerHTML = "";
      window.location.reload();
    });

  })();
</script>
    <main class="container">
    
<h1>Lemmaregister</h1>
<h2 class="h3 fw-light">"Vom Lemma zur Textstelle"</h2>
<hr/>
<p>In der Belegsuche können eine oder mehrere Wortformen mit verschiedenen Eigenschaften im Korpus gesucht werden. Die Liste kann über die + Schaltfläche ergänzt und sortiert werden.</p>
<p>Die Suche operiert direkt auf dem LEMMA_INDEX (und IndexedDB)</p>
<div id="search-control" class="mb-4"></div>
<div id="search-info"></div>
<div id="search-results"></div>
<ul class="list-group" id="search-results-list"></ul>

<script>

    // timer
    let startTime = performance.now();

    document.addEventListener("PROJECTDB_READY", function(event) {
        console.log("DB ready event", event);

        let searchResultDiv = document.getElementById("search-results");
        let searchResultList = document.getElementById("search-results-list");
        let searchInfoDiv = document.getElementById("search-info");
        let searchControlDiv = document.getElementById("search-control");

        // Allow user to set the index url parameter
        let searchParams = new URLSearchParams(window.location.search);
        let startsWithLabel = searchParams.get("index") || "a";

        // generate a list of letters from a to z
        let letters = "AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz".split("");
        let indexList = document.createElement("ul");
        indexList.className = "list-inline";
        letters.forEach((letter) => {
            let indexItem = document.createElement("li");
            indexItem.className = "list-inline-item";
            let indexLink = document.createElement("a");
            indexLink.href = `lemma-register.html?index=${letter}`;
            indexLink.innerText = letter;
            indexLink.className = "text-decoration-none";
            if (letter === startsWithLabel) {
                indexLink.classList.add("fw-bold");
            }
            indexItem.appendChild(indexLink);
            indexList.appendChild(indexItem);
        });

        searchControlDiv.prepend(indexList);


        let pagination = {
            offset: 0,
            limit: 10
        };

        // let user control the pagination
        let paginationDiv = document.createElement("div");
        paginationDiv.className = "pagination-controls";
        let prevButton = document.createElement("button");
        prevButton.className = "btn btn-outline-secondary me-2";
        prevButton.innerText = "Previous";

        prevButton.addEventListener("click", () => {
            if (pagination.offset > 0) {
                pagination.offset -= pagination.limit;
                lemmaSearch(startsWithLabel, pagination);
            }
        });

        let nextButton = document.createElement("button");
        nextButton.className = "btn btn-outline-secondary";
        nextButton.innerText = "Next";

        nextButton.addEventListener("click", () => {
            pagination.offset += pagination.limit;
            lemmaSearch(startsWithLabel, pagination);
        });

        paginationDiv.appendChild(prevButton);
        paginationDiv.appendChild(nextButton);
        //searchInfoDiv.appendChild(paginationDiv);
        searchControlDiv.appendChild(paginationDiv);


        const lemmaSearch = (startsWithLabel, pagination) => {
            window.gams.projectDB.findAllLemmataAwait(
                (resultObject) => {
                        // first clear previous results
                        searchResultList.innerHTML = "";
                        searchResultDiv.innerHTML = "<ul></ul>"; // clear previous results
                        searchInfoDiv.innerHTML = ""; // clear previous search info

                        // add found lemma count to html
                        let resultCountElement = document.createElement("p");
                        resultCountElement.innerText = `${resultObject.resultCount} results for "${startsWithLabel}"`;
                        searchResultDiv.prepend(resultCountElement);

                        // display pagination info
                        let paginationInfo = document.createElement("p");
                        paginationInfo.innerText = `Showing ${resultObject.pagination.offset + 1} to ${Math.min(resultObject.pagination.offset + resultObject.pagination.limit, resultObject.resultCount)} of ${resultObject.resultCount} results.`;
                        searchResultDiv.prepend(paginationInfo);

                        resultObject.result.forEach((foundLemma, foundLemmaId) => {
                            let hrefUrl = `http://localhost:18090/mhdbdb/objects/mhdbdb.lexicon#${foundLemma.id}`;
                            let liElement = document.createElement("li");
                            liElement.className = "list-group-item mb-2 p-0 accordion";

                            let accordionItem = document.createElement("div");
                            accordionItem.className = "accordion-item";

                            let accordionHeader = document.createElement("div");
                            accordionHeader.className = "accordion-header";
                            accordionItem.appendChild(accordionHeader);
                            accordionHeader.innerHTML = `
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#accordionItemBody_${foundLemma.id}" aria-expanded="true" aria-controls="${foundLemma.id}">${foundLemma.label_s} <small class="muted">(${foundLemma.texts_ss.length})</small></button>
                            `;
                            let accordionItemCollaps = document.createElement("div");
                            accordionItemCollaps.className = "accordion-collapse collapse";
                            accordionItemCollaps.id = `accordionItemBody_${foundLemma.id}`;

                            let accordionItemBody = document.createElement("div");
                            accordionItemBody.className = "accordion-body";

                            accordionItemCollaps.appendChild(accordionItemBody);
                            accordionItem.appendChild(accordionItemCollaps);

                            // rendering pos tags
                            let posTags = foundLemma.pos_ss.map(tag => `<span class="badge bg-light text-dark">${tag}</span>`).join(" ");
                            accordionItemBody.innerHTML += `<div class="mb-2"><strong>POS:</strong> ${posTags}</div>`;

                            // rendering lemma etymology
                            if (foundLemma.etymology_ss && foundLemma.etymology_ss.length > 0) {
                                accordionItemBody.innerHTML += `
                                    <div class="mb-2"><strong>Etymologie:</strong> ${foundLemma.etymology_ss.map(entry => `<a href="/mhdbdb/objects/mhdbdb.lexicon#${entry.corresp}" class="badge bg-light text-dark">${entry.label}</a>`).join(" ")}</div>
                                `;
                            }

                            // rendering lemma id
                            accordionItemBody.innerHTML += `<strong>Lemma-Id:</strong> <a class="text-decoration-none" target="_blank" href="/mhdbdb/objects/mhdbdb.lexicon#${foundLemma.id}"><i class="text-muted">${foundLemma.id} (zur Lemmaliste)</i></a><br/>`;


                            accordionItemBody.innerHTML += `<strong>Lemma-Okkurenz: </strong>`
                            // rendering referenced texts 
                            foundLemma.texts_ss.forEach((text, index) => {
                                let textLink = document.createElement("a");
                                textLink.textContent = text;
                                textLink.className = "text-decoration-none me-2";
                                // should be a badge
                                textLink.classList.add("badge", "bg-light", "text-dark", "me-2");
                                textLink.style.cursor = "pointer";
                                textLink.setAttribute("tabindex", "0");
                                textLink.setAttribute("data-bs-toggle", "popover");
                                textLink.setAttribute("data-bs-title", text);
                                textLink.setAttribute("data-bs-placement", "top");
                                textLink.setAttribute("data-html", "true");
                                textLink.setAttribute("data-bs-content", `
                                <ul>
                                    <li><a tabindex="0" target="_blank" href="/mhdbdb/objects/mhdbdb.${text.toLowerCase()}#${foundLemma.id}">Interaktionsansicht</a></li>
                                    
                                    <li><a tabindex="0" target="_blank" href="/mhdbdb/objects/mhdbdb.${text.toLowerCase()}?mode=text_analysis&anyRef=${foundLemma.id}">Analyseansicht</a></li>
                                </ul>`.trim().replaceAll('  ', ' '));

                                accordionItemBody.appendChild(textLink);

                                new bootstrap.Popover(textLink, {
                                    trigger: 'hover',
                                    html: true,
                                    // this will ensure that popover is not closed when clicking on the link inside it
                                    container: textLink
                                });

                                //let textLemmaUrl = `http://localhost:18090/mhdbdb/objects/mhdbdb.${text.toLowerCase()}#${foundLemma.id}`;
                                //liElement.innerHTML += `<a class="text-decoration-none" target="_blank" href="${textLemmaUrl}">${text}</a>, `;
                            });

                            liElement.appendChild(accordionItem);

                            let wordSensesHeader = document.createElement("h5");
                            wordSensesHeader.classList.add("mt-3")
                            wordSensesHeader.classList.add("h5")
                            wordSensesHeader.textContent = "Wortbedeutungen"
                            accordionItemBody.appendChild(wordSensesHeader);

                            accordionHeader.addEventListener("click", () => {
                                
                                let senseUlId = `senses_ul_${foundLemma.id}`;
                                let existingSensesUl = document.getElementById(senseUlId);
                                if (existingSensesUl) {
                                    existingSensesUl.remove();
                                    return;
                                }

                                

                                window.gams.projectDB.findAllSensesByLemmaId(foundLemmaId, resultObject => {
                                    let sensesUl = document.createElement("ul");
                                    sensesUl.className = "list-group";
                                    sensesUl.id = senseUlId;
                                    resultObject.senses.forEach((sense, index) => {
                                        let senseLi = document.createElement("li");
                                        senseLi.className = "list-group-item mb-2 border";
                                        senseLi.innerHTML = `
                                            <span class="text-muted">Bedeutung ${index + 1}</span>
                                            <i class="text-muted">(${sense.id})</i><br/>

                                        `;

                                        sense.concepts_ss.forEach((refConceptId, index) => {
                                            let conceptA = document.createElement("a");
                                            conceptA.className = "text-decoration-none";
                                            conceptA.target = "_blank";
                                            conceptA.href = `/mhdbdb/objects/mhdbdb.concepts#${refConceptId}`;
                                            conceptA.textContent = resultObject.conceptsSenseMap.get(refConceptId).labels_ss[0] + " & ";
                                            senseLi.appendChild(conceptA);
                                        });


                                        senseLi.appendChild(document.createElement("br"));

                                        sense.texts_ss.forEach((text, index) => {

                                            let textLink = document.createElement("a");
                                            textLink.textContent = text;
                                            textLink.className = "text-decoration-none me-2";
                                            // should be a badge
                                            textLink.classList.add("badge", "bg-light", "text-dark", "me-2");
                                            textLink.style.cursor = "pointer";
                                            textLink.setAttribute("tabindex", "0");
                                            textLink.setAttribute("data-bs-toggle", "popover");
                                            textLink.setAttribute("data-bs-title", text);
                                            textLink.setAttribute("data-bs-placement", "top");
                                            textLink.setAttribute("data-html", "true");
                                            textLink.setAttribute("data-bs-content", `
                                            <ul>
                                                <li><a tabindex="0" target="_blank" href="/mhdbdb/objects/mhdbdb.${text.toLowerCase()}#${sense.id}">Interaktionsansicht</a></li>

                                                <li><a tabindex="0" target="_blank" href="/mhdbdb/objects/mhdbdb.${text.toLowerCase()}?mode=text_analysis&anyRef=${sense.id}">Analyseansicht</a></li>
                                            </ul>`.trim().replaceAll('  ', ' '));

                                            senseLi.appendChild(textLink);

                                            new bootstrap.Popover(textLink, {
                                                trigger: 'hover',
                                                html: true,
                                                // this will ensure that popover is not closed when clicking on the link inside it
                                                container: textLink
                                            });

                                            //let textLemmaUrl = `http://localhost:18090/mhdbdb/objects/mhdbdb.${text.toLowerCase()}#${foundLemma.id}`;
                                            //liElement.innerHTML += `<a class="text-decoration-none" target="_blank" href="${textLemmaUrl}">${text}</a>, `;
                                        });

                                        

                                        

                                        sensesUl.appendChild(senseLi);
                                    });

                                    accordionItemBody.appendChild(sensesUl);

                                    
                                });
                            });

                            searchResultList.appendChild(liElement);
                        });
                    }, 
                    startsWithLabel, 
                    pagination,
                    true
                );
        }

        lemmaSearch(startsWithLabel, pagination);



        


    

    });




</script>

    </main>
    <footer class="mt-md-5 pb-md-5 pt-md-5 bg-light">
    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <ul class="list-unstyled">
                    <li><a href="/mhdbdb/imprint.html">Impressum</a></li>
                    <li><a target="_blank" href="https://gams.uni-graz.at/archive/objects/context:gams/methods/sdef:Context/get?mode=dataprotection&locale=de">Datenschutz</a></li>
                </ul>
                <h3 class="h5">Kontakt</h3>
                <ul class="list-unstyled">
                    <li>Sebastian David Schiller-Stoff</li>
                    <li>DDH | Institut für Digitale Geisteswissenschaften</li>
                    <li>Universität Graz</li>
                    <li><a target="_blank" href="https://gams.uni-graz.at/archive/objects/context:gams/methods/sdef:Context/get?mode=dataprotection&locale=de"><img width="200" src="https://gams.uni-graz.at/templates/img/by-nc.png"/></a></li>
                </ul>
            </div>
            <div class="col-md-6">
                <a target="_blank" href="http://localhost:18085/api/v1/projects/mhdbdb/objects/mhdbdb.material/datastreams/LOGO_MAIN01.png/content"><img src="http://localhost:18085/api/v1/projects/mhdbdb/objects/mhdbdb.material/datastreams/LOGO_MAIN01.png/content" /></a>
                <a target="_blank" href="http://localhost:18085/api/v1/projects/mhdbdb/objects/mhdbdb.material/datastreams/LOGO_IZMF.png/content"><img width="300" src="http://localhost:18085/api/v1/projects/mhdbdb/objects/mhdbdb.material/datastreams/LOGO_IZMF.png/content" /></a>
                <a target="_blank" href="http://localhost:18085/api/v1/projects/mhdbdb/objects/mhdbdb.material/datastreams/CLARIAH_LOGO.png/content"><img width="300" src="http://localhost:18085/api/v1/projects/mhdbdb/objects/mhdbdb.material/datastreams/CLARIAH_LOGO.png/content" /></a>
                <a target="_blank" href="http://localhost:18085/api/v1/projects/mhdbdb/objects/mhdbdb.material/datastreams/CLARIAH_LOGO.png/content"><img width="300" src="http://localhost:18085/api/v1/projects/mhdbdb/objects/mhdbdb.material/datastreams/FBGERMANISTIK_LOGO1.jpg/content" /></a>
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    
  </body>
</html>